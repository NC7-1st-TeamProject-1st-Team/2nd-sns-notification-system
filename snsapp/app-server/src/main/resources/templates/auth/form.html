<!DOCTYPE html>
<html lang="en">
<style>
  html {
    height: 100%;
  }

  body {
    height: 100%;
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    display: grid;
    justify-items: center;
    align-items: center;
    background-color: #3a3a3a;
  }

  #main-holder {
    width: 50%;
    height: 70%;
    display: grid;
    justify-items: center;
    align-items: center;
    background-color: white;
    border-radius: 7px;
    box-shadow: 0px 0px 5px 2px black;
  }

  #login-error-msg-holder {
    width: 100%;
    height: 100%;
    display: grid;
    justify-items: center;
    align-items: center;
  }

  #login-error-msg {
    width: 23%;
    text-align: center;
    margin: 0;
    padding: 5px;
    font-size: 12px;
    font-weight: bold;
    color: #8a0000;
    border: 1px solid #8a0000;
    background-color: #e58f8f;
    opacity: 0;
  }

  #error-msg-second-line {
    display: block;
  }

  #login-form {
    align-self: flex-start;
    display: grid;
    justify-items: center;
    align-items: center;
  }

  .login-form-field::placeholder {
    color: #3a3a3a;
  }

  .login-form-field {
    border: none;
    border-bottom: 1px solid #3a3a3a;
    margin-bottom: 10px;
    border-radius: 3px;
    outline: none;
    padding: 0px 0px 5px 5px;
  }


  #login-form-submit {
    width: 100%;
    padding: 7px;
    border: none;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    background-color: #3a3a3a;
    cursor: pointer;
    outline: none;
  }

  .user-field {
    display: block;
    width: 220px; height: 30px;
    margin: 0 auto;
  }
  .user2-field {
    display: block;
    width: 220px; height: 100px;
    margin: 0 auto;
  }
</style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BITSNS</title>
</head>

<body>
<main id="main-holder">
  <h1>BITSNS</h1>

  <div id="login-error-msg-holder">
    <p id="login-error-msg">Invalid username <span id="error-msg-second-line">and/or password</span></p>
  </div>

  <form id="login-form" method="post">
    <!-- 사용자 입력 필드 -->
    <input type="text" name="phoneNumber" id="username-field" class="login-form-field" placeholder="Phone Number">
    <input type="password" name="password" id="password-field" class="login-form-field" placeholder="Password">
    <input type="submit" value="Login" id="login-form-submit">

    <ul>
      <li><a href="/auth/add" class="user-field"> 회원가입</a></li>
      <li><a href="/auth/find" class="user2-field"> 비밀번호 찾기</a></li>
    </ul>
  </form>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginForm = document.getElementById("login-form");
      const loginErrorMsg = document.getElementById("login-error-msg");

      loginForm.addEventListener("submit", function (event) {
        const phoneNumber = loginForm.querySelector("#username-field").value;
        const password = loginForm.querySelector("#password-field").value;

        // Ajax 요청 보내기
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "login", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.onload = function () {
          if (xhr.status === 200) {
            // 로그인 성공
            loginErrorMsg.style.opacity = 0; // 에러 메시지 감추기
            alert("로그인에 성공하였습니다.");
            const responseData = JSON.parse(xhr.responseText); // JSON 응답 데이터 파싱
            const userNo = responseData.userNo; // 사용자 번호 추출
            location.href = `/myPage/${userNo}`; // 사용자 번호를 기반으로 리다이렉트
          } else {
            // 로그인 실패
            loginErrorMsg.style.opacity = 1; // 에러 메시지 표시
            loginErrorMsg.innerText = "로그인 실패, 다시 시도하세요."; // 에러 메시지 설정
          }
        };

        // 요청 본문 설정
        const data = `phoneNumber=${phoneNumber}&password=${password}`;
        xhr.send(data);

        event.preventDefault(); // 폼 제출 방지
      });
    });
</script>
</main>
</body>


</html>