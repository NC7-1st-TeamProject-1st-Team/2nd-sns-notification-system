<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Î∞©Î™ÖÎ°ù</title>
    <!-- Ïä§ÌÉÄÏùºÍ≥º Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞ÄÍ∞Ä ÌïÑÏöîÌïòÎ©¥ Ïó¨Í∏∞Ïóê -->
    <link rel="stylesheet" type="text/css" href="/css/header.css">
    <link rel="stylesheet" type="text/css" href="/css/board/read.css">

    <script>
        function toggleLikeButtons(boardNo) {
            const likeButton = document.getElementById('likeButton-' + boardNo);
            const unlikeButton = document.getElementById('unlikeButton-' + boardNo);

            // Î≤ÑÌäºÏùò ÌëúÏãú ÏÉÅÌÉúÎ•º Ï†ÑÌôò
            if (likeButton.style.display === 'none' || likeButton.style.display === '') {
                likeButton.style.display = 'inline-block';
                unlikeButton.style.display = 'none';
            } else {
                likeButton.style.display = 'none';
                unlikeButton.style.display = 'inline-block';
            }
        }

        function likeButtonClicked(buttonElement) {
            const boardNo = buttonElement.getAttribute("data-board-no");

            fetch(`/board/like?boardNo=${boardNo}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (response.ok) {
                        alert("Ï¢ãÏïÑÏöîÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.");
                        toggleLikeButtons(boardNo); // Î≤ÑÌäº ÏÉÅÌÉú Ï†ÑÌôò Ìï®Ïàò Ìò∏Ï∂ú
                    } else {
                        alert("Ï¢ãÏïÑÏöî Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                });
        }

        function unlikeButtonClicked(buttonElement) {
            const boardNo = buttonElement.getAttribute("data-board-no");

            fetch(`/board/unlike?boardNo=${boardNo}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (response.ok) {
                        alert("Ï¢ãÏïÑÏöî Ï∑®ÏÜåÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.");
                        toggleLikeButtons(boardNo); // Î≤ÑÌäº ÏÉÅÌÉú Ï†ÑÌôò Ìï®Ïàò Ìò∏Ï∂ú
                    } else {
                        alert("Ï¢ãÏïÑÏöî Ï∑®ÏÜå Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                });
        }
    </script>

</head>

<body>

    <div data-th-replace="header :: header"></div>

    <form data-th-action="@{/board/add}" method='post' enctype='multipart/form-data'>
        <table>
            <tr>
                <th>Ï†úÎ™©</th>
                <td><input type="text" name="title"></td>
            </tr>
            <tr>
                <th>ÎÇ¥Ïö©</th>
                <td><textarea name="content" rows="10"></textarea></td>
            </tr>
            <input type='hidden' name='category' data-th-value="${param.category}">
            <input type='file' name='files' class='hidden-file-input' multiple placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"><br>
            <!--ÌååÏùº ÏÑ†ÌÉù Î∂ÄÎ∂Ñ Ìà¨Î™ÖÏúºÎ°ú Î∞îÍøîÏ§å -->
        </table>
        <div style="text-align: center; margin-left:37%; margin-bottom:2%;">
            <button>Îì±Î°ù</button>
        </div>
    </form>


    <!-- Í≤åÏãúÍ∏Ä Î™©Î°ùÏùÑ Ï∂úÎ†•ÌïòÍ∏∞ ÏúÑÌïú Thymeleaf Î∞òÎ≥µÎ¨∏ -->
    <div data-th-each="board : ${list}">
        <div class="container">
            <!-- Í≤åÏãúÍ∏Ä Î™©Î°ù -->
            <table class="content-table">
                <!-- Ï≤´ Î≤àÏß∏ Ìñâ: Î≤àÌò∏, Ï†úÎ™©, Î©îÌÉÄ Ï†ïÎ≥¥ -->
                <tr class="first-row">
                    <td class="no-cell" style="text-align: center;">
                        <span th:text="'No. ' + ${board.no}"></span>
                    </td>
                    <td class="title-meta-cell" colspan="3">
                        <div class="horizontal-layout">
                            <span th:text="${board.title}"></span>
                            <div class="meta-info">
                                <img class="clock-icon" src="/images/clock.png">
                                <span th:text="${#dates.format(board.createdAt, 'yyyy-MM-dd')}"></span>
                            </div>
                        </div>
                    </td>
                </tr>
                <!-- Îëê Î≤àÏß∏ Ìñâ: ÏûëÏÑ±Ïûê, ÎÇ¥Ïö©, Ï¢ãÏïÑÏöî -->
                <tr class="second-row">
                    <td class="writer-cell" style="text-align: center;">
                        <div class="profile-picture" style="display: inline-block;">
                            <img class="profile-image" src="/images/profile.png" alt="Profile Picture" />
                            <!-- ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑÏùÑ Ïã§Ï†ú Ïù¥ÎØ∏ÏßÄÎ°ú Î∞îÍæ∏ÏÑ∏Ïöî. -->
                        </div>
                        <div style="margin-top: 5px;"> <!-- Ïù¥Î¶ÑÍ≥º ÌîÑÎ°úÌïÑ ÏÇ¨ÏßÑ ÏÇ¨Ïù¥Ïóê Í∞ÑÍ≤©ÏùÑ Ï°∞Ï†àÌï©ÎãàÎã§. -->
                            <span th:text="${board.writer.name}"></span>
                        </div>
                    </td>
                    <td class="content-like-cell" colspan="3" style="position: relative;">
                        <span th:if="${board != null}" th:text="${board.content != null ? board.content : 'ÎÇ¥Ïö©ÏûÖÎãàÎã§!'}"></span>
                        <!-- Ï¢ãÏïÑÏöî Î≤ÑÌäº -->
                        <button class="like-button" th:id="'likeButton-' + ${board.no}" th:if="${!likedBoards.contains(board.no)}" th:attr="data-board-no=${board.no}" onclick="likeButtonClicked(this)">
                            ü§ç
                        </button>

                        <!-- Ï¢ãÏïÑÏöî Ï∑®ÏÜå (Ï¢ãÏïÑÏöî ÎàåÎü¨Ï†∏ÏûàÎäîÏÉÅÌÉú) Î≤ÑÌäº -->
                        <button class="unlike-button" th:id="'unlikeButton-' + ${board.no}" th:if="${likedBoards.contains(board.no)}" th:attr="data-board-no=${board.no}" onclick="unlikeButtonClicked(this)">
                            ‚ù§Ô∏è
                        </button>
                    </td>
                </tr>
            </table>
            <div class="btn-container">
                <a data-th-href="@{/board/delete(category=${board != null ? board.category : 'default'},no=${board != null ? board.no : '0'})}">
                    <div style="text-align: center; margin-left:37%; margin-bottom:2%;">
                        <button>ÏÇ≠Ï†ú</button>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div data-th-replace="footer :: footer"></div>
</body>

</html>